@using System.Security.Claims
@model IEnumerable<Casusvictuz.Event>

@{
    ViewData["Title"] = "Evenementen";
}

@if (User.Identity.IsAuthenticated)
{
    <!-- Code for Logged-in User -->
    <h1>Alle opkomende evenementen</h1>

    <form asp-action="IndexUser" method="get">
        <div class="form-group">
            <input type="text" name="searchString" class="form-control" placeholder="Zoek op evenement naam" value="@ViewData["CurrentFilter"]" />
        </div>
        <p></p>
        <button type="submit" class="btn btn-primary">Zoeken</button>
    </form>

    @if (User.HasClaim("IsMember", "True"))
    {
        <div>
            <a asp-action="CreateSuggestion" asp-route-id="@int.Parse(User.FindFirst(ClaimTypes.NameIdentifier)?.Value)" class="btn btn-primary">Evenement Suggestie Maken</a>
        </div>
    }

    <div class="container d-flex flex-row flex-wrap">
        @foreach (var item in Model)
        {
            <div class="card p-2 m-1" style="width:18rem;">
                @{
                    string imgToShow = item.UrlLinkPicture ?? "https://i.pinimg.com/originals/8e/07/80/8e078013204d0cc9876e9edbb1fd3f85.jpg";
                }
                <img class="card-img-top IndexPicture" src="@imgToShow" alt="Afbeelding niet beschikbaar" />

                <div class="card-body">
                    <h5 class="card-title">@item.Name</h5>
                    <p class="card-text">@item.Description</p>
                    <p class="fw-bold">Datum: @(item.Date?.ToString("dd-MM-yyyy") ?? "N/A")</p>
                    <p>Beschikbare plaatsen: @item.Registrations.Count() / @item.Spots</p>
                    <a asp-action="DetailsUser" asp-route-id="@item.Id" class="btn btn-primary">Details</a>

                    @{
                        string buttonToShow = "openRegister";
                        if (item.Spots == item.Registrations.Count())
                        {
                            buttonToShow = "closedRegister";
                        }

                        var loggedInUserId = User.FindFirst(ClaimTypes.NameIdentifier)?.Value;
                        if (!string.IsNullOrEmpty(loggedInUserId))
                        {
                            int userId = int.Parse(loggedInUserId);
                            if (item.Registrations.Any(r => r.UserId == userId))
                            {
                                buttonToShow = "alreadyRegistered";
                            }
                        }
                    }

                    @if (buttonToShow == "closedRegister")
                    {
                        <a href="#" class="btn btn-secondary" disabled>Gesloten</a>
                    }
                    else if (buttonToShow == "openRegister")
                    {
                        <a asp-action="Register" asp-controller="Events" asp-route-eventId="@item.Id" class="btn btn-primary">Inschrijven</a>
                    }
                    else if (buttonToShow == "alreadyRegistered")
                    {
                        <a asp-action="Unregister" asp-controller="Events" asp-route-id="@item.Registrations.First(r => r.UserId == int.Parse(User.FindFirst(ClaimTypes.NameIdentifier).Value)).Id" class="btn btn-danger">Uitschrijven</a>
                    }
                </div>
            </div>
        }
    </div>
}
else
{
    <!-- Code for Non-Logged-in User -->
    <div class="container text-center mt-5">
        <section>
            <h2>Welkom bij Victuz Evenementen</h2>
            <p class="lead">Ervaar de beste evenementen speciaal voor jou. Om meer details te bekijken en om je in te schrijven, dien je ingelogd te zijn.</p>
            <p>Maak een account aan of log in om deel te nemen aan unieke ervaringen en ontmoet inspirerende mensen.</p>
            <a href="/users/login" class="btn btn-primary btn-lg mt-3">Log in om verder te gaan</a>
        </section>

        <section class="mt-5">
            <h3>Waarom lid worden?</h3>
            <ul class="list-unstyled">
                <li><strong>ðŸŒŸ Exclusieve toegang</strong> â€“ Bekijk en schrijf je in voor evenementen die speciaal zijn samengesteld voor onze leden.</li>
                <li><strong>ðŸŽŸ Voorrang bij inschrijving</strong> â€“ Zorg ervoor dat je een plekje hebt voor onze populaire evenementen.</li>
                <li><strong>ðŸ“… Makkelijk beheer</strong> â€“ Hou je inschrijvingen en favoriete evenementen overzichtelijk op Ã©Ã©n plek.</li>
            </ul>
            <p class="mt-4">Log in om de volledige lijst met evenementen te ontdekken en mis geen enkele ervaring!</p>
            <a href="/users/login" class="btn btn-outline-primary btn-lg mt-3">Log in om je ervaring te beginnen</a>
        </section>

        <section class="mt-5">
            <h3>Uitgelichte Evenementen</h3>
            <div class="row mt-4">
                <div class="col-md-4">
                    <div class="card">
                        <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSfuSSwqzg0yhNVNxHzPtEE7E9CUW1r3u-6xbwSG-4jf_PhWF5UZYqqQodP9iBN038dLao&usqp=CAU" class="card-img-top" alt="Muziekconcert">
                        <div class="card-body">
                            <h5 class="card-title">Muziekconcert</h5>
                            <p class="card-text">Geniet van een avond vol live muziek in het hart van de stad.</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card">
                        <img src="https://www.simac.com/uploads/cache/content_image_wide/uploads/media/64b7ad5d915b8/img-5575.jpg" class="card-img-top" alt="Technologie Workshop">
                        <div class="card-body">
                            <h5 class="card-title">Technologie Workshop</h5>
                            <p class="card-text">Ontdek de nieuwste ontwikkelingen in de techwereld. Leer, deel en groei!</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card">
                        <img src="https://www.vvvheerlen.nl/media/880381/2-inti-street-art-heerlen-visit-zl-2023-2.jpg?width=800&height=800&v=1dacc9e1f0b1510" class="card-img-top" alt="Kunsttentoonstelling">
                        <div class="card-body">
                            <h5 class="card-title">Kunsttentoonstelling</h5>
                            <p class="card-text">Verken kunst van getalenteerde lokale artiesten in een inspirerende omgeving.</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section class="mt-5">
            <h3>Klaar om mee te doen?</h3>
            <p>Mis geen enkel evenement en beleef onvergetelijke momenten met Victuz. Log in of maak een account aan om toegang te krijgen tot alle mogelijkheden!</p>
            <a href="/users/login" class="btn btn-primary btn-lg mt-3">Log in om verder te gaan</a>
        </section>
    </div>
}
